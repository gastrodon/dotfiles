#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

case "${1:-build}" in
  build)
    nixos-rebuild build -I nixos-config="$SCRIPT_DIR/configuration.nix"
    ;;
  switch)
    cp -r "$SCRIPT_DIR"/{*.nix,module,package} /etc/nixos/
    nixos-rebuild switch
    ;;
  *)
    echo "Usage: sudo $0 [build|switch]"
    echo "  build  - Build configuration (default)"
    echo "  switch - Copy files to /etc/nixos and switch"
    exit 1
    ;;
esac
